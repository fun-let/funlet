<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUNLET Admin V11 - Revenue</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* (ìŠ¤íƒ€ì¼ì€ V10ê³¼ ê±°ì˜ ë™ì¼, ì¼ë¶€ë§Œ ìˆ˜ì •) */
        body { margin: 0; background: #111; color: #fff; font-family: 'Noto Sans KR'; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 250px; background: #1a1a1a; padding: 20px; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .content { flex: 1; padding: 40px; overflow-y: auto; }
        .menu-item { padding: 15px; cursor: pointer; color: #aaa; margin-bottom: 5px; border-radius: 8px; font-weight: bold; }
        .menu-item.active, .menu-item:hover { background: #333; color: #00ff9d; }
        .page { display: none; } .page.active { display: block; }
        
        .card { background: #222; padding: 20px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 10px; background: #111; border: 1px solid #444; color: white; margin-bottom: 10px; border-radius: 5px; box-sizing: border-box; }
        button { padding: 10px; background: #00ff9d; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        
        /* ê´‘ê³  íƒ€ì… ì„ íƒ ë¼ë””ì˜¤ */
        .radio-group { display: flex; gap: 20px; margin-bottom: 15px; }
        .radio-group label { cursor: pointer; color: #ccc; }
        input[type="radio"] { width: auto; margin-right: 5px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 style="color:#00ff9d; margin:0 0 30px 0;">ADMIN V11</h2>
        <div class="menu-item active" onclick="go('game')">ğŸ® ê²Œì„ ê´€ë¦¬</div>
        <div class="menu-item" onclick="go('ad-manager')">ğŸ’° ê´‘ê³  ìˆ˜ìµí™” ê´€ë¦¬</div>
        <div class="menu-item" onclick="go('assets')">ğŸ–¼ï¸ ìì‚° ê´€ë¦¬</div>
        <div style="margin-top:auto">
            <input type="password" id="token" placeholder="Token" onchange="saveToken()">
        </div>
    </div>

    <div class="content">
        <div id="page-game" class="page active">
            <h2>ğŸ® ê²Œì„ ê´€ë¦¬</h2>
            <div class="card">
                <p style="color:#888;">* ê¸°ì¡´ V10 ê¸°ëŠ¥ê³¼ ë™ì¼í•©ë‹ˆë‹¤. (ì½”ë“œ ìˆ˜ì •, ì‹ ê·œ ìƒì„±)</p>
                <button onclick="alert('ê²Œì„ ê´€ë¦¬ ê¸°ëŠ¥ì€ V10ê³¼ ë™ì¼í•©ë‹ˆë‹¤. (ê´‘ê³  ì„¤ì •ì— ì§‘ì¤‘í•˜ì„¸ìš”!)')">ê²Œì„ ê´€ë¦¬ ì—´ê¸° (ì§€ê¸ˆì€ ìƒëµ)</button>
            </div>
        </div>

        <div id="page-ad-manager" class="page">
            <h2>ğŸ’° ê´‘ê³  ë°°ë„ˆ ë° ì „ë©´ê´‘ê³  ì„¤ì •</h2>
            
            <div class="card">
                <label>1. ì„¤ì •í•  ê´‘ê³  ì˜ì—­ ì„ íƒ</label>
                <select id="adSlot" onchange="loadAdData()">
                    <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                    <option value="mainTop">ğŸ–¥ï¸ ë©”ì¸ ìƒë‹¨ ë°°ë„ˆ</option>
                    <option value="gameBottom">ğŸ“± ê²Œì„ í•˜ë‹¨ ë°°ë„ˆ</option>
                    <option value="sidebar">â– ì‚¬ì´ë“œë°” ë°°ë„ˆ</option>
                    <option value="interstitial">âœ¨ [ì „ë©´ê´‘ê³ ] (ê²Œì„ ì¢…ë£Œ ì‹œ)</option>
                    <option value="hero">ğŸ–¼ï¸ ë©”ì¸ íƒ€ì´í‹€ ë°°ê²½</option>
                </select>
            </div>

            <div class="card" id="adEditArea" style="display:none;">
                <label>2. ê´‘ê³  íƒ€ì… ì„ íƒ</label>
                <div class="radio-group">
                    <label><input type="radio" name="adType" value="image" onclick="toggleAdType()" checked> ì´ë¯¸ì§€ ë°°ë„ˆ (ì§ì ‘ ì—…ë¡œë“œ)</label>
                    <label><input type="radio" name="adType" value="code" onclick="toggleAdType()"> ì½”ë“œ ì‚½ì… (ì• ë“œì„¼ìŠ¤/ì¿ íŒ¡)</label>
                </div>

                <div id="typeImage">
                    <label>ì´ë¯¸ì§€ URL (ìì‚°ì—ì„œ ì—…ë¡œë“œ í›„ ì£¼ì†Œ ë³µì‚¬)</label>
                    <input type="text" id="adImgUrl" placeholder="https://...">
                    <label>í´ë¦­ ì‹œ ì´ë™í•  ë§í¬ URL</label>
                    <input type="text" id="adLink" placeholder="https://...">
                </div>

                <div id="typeCode" style="display:none;">
                    <label>ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸ / HTML ì½”ë“œ</label>
                    <textarea id="adCode" style="height:150px; font-family:monospace;" placeholder='<script>...</script> ë˜ëŠ” <iframe>...</iframe>'></textarea>
                    <p style="font-size:0.8rem; color:#aaa;">* êµ¬ê¸€ ì• ë“œì„¼ìŠ¤ë‚˜ ì œíœ´ ë§ˆì¼€íŒ… ì½”ë“œë¥¼ ì—¬ê¸°ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
                </div>

                <button onclick="saveAdSetting()" style="width:100%; margin-top:10px;">ì„¤ì • ì €ì¥í•˜ê¸°</button>
            </div>
        </div>

        <div id="page-assets" class="page">
            <h2>ğŸ–¼ï¸ íŒŒì¼ ì—…ë¡œë“œ</h2>
            <div class="card">
                <input type="text" id="uploadPath" placeholder="ê²½ë¡œ (ì˜ˆ: images/banner_new.png)">
                <input type="file" id="uploadFile">
                <button onclick="uploadAsset()">ì—…ë¡œë“œ & ì£¼ì†Œ ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <script>
        const USER = 'fun-let'; const REPO = 'funlet';
        let adsData = {}; let adsSha = null;

        window.onload = () => {
            const t = localStorage.getItem('token');
            if(t) { document.getElementById('token').value = t; loadAdsJson(); }
        }
        function saveToken() { localStorage.setItem('token', document.getElementById('token').value); loadAdsJson(); }
        function go(p) { 
            document.querySelectorAll('.page').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
            document.getElementById('page-'+p).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        async function loadAdsJson() {
            const token = document.getElementById('token').value;
            try {
                let res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/data/ads.json`, {headers:{Authorization:`token ${token}`}});
                let d = await res.json();
                adsSha = d.sha;
                adsData = JSON.parse(new TextDecoder().decode(Uint8Array.from(atob(d.content), c=>c.charCodeAt(0))));
            } catch(e) { console.log("ê´‘ê³  ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
        }

        function loadAdData() {
            const slot = document.getElementById('adSlot').value;
            const area = document.getElementById('adEditArea');
            if(!slot) { area.style.display='none'; return; }
            area.style.display='block';

            const data = adsData[slot] || { type: 'image', content: '', link: '' };
            
            // íƒ€ì… ì„¤ì •
            const radios = document.getElementsByName('adType');
            if(data.type === 'code') radios[1].checked = true;
            else radios[0].checked = true;
            toggleAdType();

            // ë°ì´í„° ì±„ìš°ê¸°
            if(data.type === 'code') {
                document.getElementById('adCode').value = data.content || '';
            } else {
                document.getElementById('adImgUrl').value = data.content || '';
                document.getElementById('adLink').value = data.link || '';
            }
        }

        function toggleAdType() {
            const isCode = document.querySelector('input[name="adType"]:checked').value === 'code';
            document.getElementById('typeImage').style.display = isCode ? 'none' : 'block';
            document.getElementById('typeCode').style.display = isCode ? 'block' : 'none';
        }

        async function saveAdSetting() {
            const slot = document.getElementById('adSlot').value;
            const type = document.querySelector('input[name="adType"]:checked').value;
            
            if(!adsData[slot]) adsData[slot] = {};
            adsData[slot].type = type;

            if(type === 'code') {
                adsData[slot].content = document.getElementById('adCode').value;
                delete adsData[slot].link; // ì½”ë“œí˜•ì€ ë§í¬ ë¶ˆí•„ìš”
            } else {
                adsData[slot].content = document.getElementById('adImgUrl').value;
                adsData[slot].link = document.getElementById('adLink').value;
            }

            // ì €ì¥
            const token = document.getElementById('token').value;
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(adsData, null, 2))));
            
            await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/data/ads.json`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: `Update Ad ${slot}`, content: content, sha: adsSha })
            });
            
            alert("ê´‘ê³  ì„¤ì • ì €ì¥ ì™„ë£Œ!");
            loadAdsJson(); // SHA ê°±ì‹ 
        }

        // íŒŒì¼ ì—…ë¡œë“œ (ê°„ì†Œí™”)
        async function uploadAsset() {
            const token = document.getElementById('token').value;
            const path = document.getElementById('uploadPath').value;
            const file = document.getElementById('uploadFile').files[0];
            
            if(!path || !file) return alert("ê²½ë¡œì™€ íŒŒì¼ í™•ì¸");
            
            const reader = new FileReader();
            reader.onload = async function() {
                const content = reader.result.split(',')[1];
                // SHA ì¡°íšŒ
                let sha = null;
                try {
                    let res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`, {headers:{Authorization:`token ${token}`}});
                    if(res.ok) sha = (await res.json()).sha;
                } catch(e){}

                await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "Upload Asset", content: content, sha: sha })
                });
                
                const url = `https://${USER}.github.io/${REPO}/${path}`;
                alert("ì—…ë¡œë“œ ì„±ê³µ! ì£¼ì†Œ ë³µì‚¬ë¨: " + url);
                navigator.clipboard.writeText(url);
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
