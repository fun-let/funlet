<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pet Gacha V2 - ë¬´ì—­ì™•</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #FF9F1C; --bg: #4ECDC4; --panel: #F7FFF7; }
        body { margin:0; background-color:var(--bg); color:#333; font-family:'Jua', sans-serif; overflow:hidden; user-select:none; }
        
        /* ë ˆì´ì•„ì›ƒ */
        .game-container { display:flex; height:100vh; background: radial-gradient(circle, #F7FFF7 0%, #4ECDC4 100%); }
        .play-area { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; }
        
        /* ìƒë‹¨ ì •ë³´ */
        .info-bar { position:absolute; top:20px; text-align:center; width: 100%; }
        .money-box { 
            display:inline-flex; align-items:center; gap:10px;
            background: white; padding: 10px 30px; border-radius: 40px; 
            box-shadow: 0 5px 0 #2980b9; border: 3px solid #333;
            font-size: 1.8rem; margin-bottom: 10px;
        }
        .cps-box { font-size: 1rem; color: white; text-shadow: 1px 1px 0 #333; background: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px; display: inline-block;}

        /* ì•Œ ë²„íŠ¼ */
        .egg-btn {
            width: 260px; height: 260px; cursor: pointer;
            transition: transform 0.1s; position: relative; z-index: 5; margin-top: 20px;
        }
        .egg-btn img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 15px 15px rgba(0,0,0,0.2)); }
        .egg-btn:active { transform: scale(0.95); }
        .shaking { animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }

        /* ë½‘ê¸° ë²„íŠ¼ */
        .gacha-btn {
            margin-top: 30px; padding: 15px 40px; font-size: 1.3rem; 
            background: #FF6B6B; color: white; border: 3px solid #333; 
            border-radius: 20px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; 
            font-family: 'Black Han Sans'; transition: 0.1s;
        }
        .gacha-btn:active { transform: translateY(5px); box-shadow: none; }

        /* ì¸ë²¤í† ë¦¬ (ìš°ì¸¡) */
        .inventory-area { 
            width: 360px; background: white; border-left: 4px solid #333; 
            display: flex; flex-direction: column; z-index: 10;
        }
        .inv-header { padding: 15px; text-align: center; background: #FF9F1C; color: white; border-bottom: 3px solid #333; }
        .inv-list { flex: 1; overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; align-content: start; }
        
        .inv-item {
            background: #f8f9fa; border-radius: 12px; padding: 5px; text-align: center;
            border: 2px solid #ddd; cursor: pointer; position: relative;
        }
        .inv-item.locked { opacity: 0.5; filter: grayscale(100%); pointer-events: none; }
        .inv-item:hover { border-color: #FF9F1C; transform: translateY(-2px); }
        .inv-item img { width: 100%; height: 60px; object-fit: contain; }
        
        /* í« ìƒì„¸/íŒë§¤ íŒì—… */
        .pet-popup {
            position: absolute; bottom: 0; left: 0; width: 100%; background: white;
            border-top: 3px solid #333; padding: 20px; box-sizing: border-box;
            transform: translateY(100%); transition: 0.3s;
            display: flex; flex-direction: column; align-items: center;
        }
        .pet-popup.show { transform: translateY(0); }
        .sell-btn {
            background: #27ae60; color: white; border: none; padding: 8px 20px; 
            border-radius: 10px; cursor: pointer; font-family: 'Jua'; margin-top: 10px;
            font-size: 1.1rem; box-shadow: 0 3px 0 #219150;
        }

        /* ë“±ê¸‰ ìƒ‰ìƒ */
        .g-C { border-color: #95a5a6; background: #ecf0f1; }
        .g-R { border-color: #3498db; background: #eaf6ff; }
        .g-E { border-color: #9b59b6; background: #f5eef8; }
        .g-L { border-color: #f1c40f; background: #fcf8e3; box-shadow: 0 0 10px #f1c40f; }
        .g-M { border-color: #e74c3c; background: #fdedec; animation: pulse 2s infinite; }

        /* ê²°ê³¼ í™”ë©´ */
        .result-screen {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85); z-index: 100; display:none;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .card-reveal {
            width: 280px; background: white; border-radius: 25px; padding: 30px;
            text-align: center; animation: zoomIn 0.4s; position: relative;
        }
        
        /* ê´‘ê³  ì˜ì—­ */
        .ad-area { position: absolute; bottom: 10px; width: 320px; height: 100px; }

        @media (max-width: 768px) {
            .game-container { flex-direction: column; }
            .inventory-area { width: 100%; height: 45%; }
            .egg-btn { width: 180px; height: 180px; margin-top: 10px; }
            .pet-popup { position: fixed; bottom: 0; z-index: 200; border-top: 4px solid #333; }
        }
    </style>
</head>
<body>

    <audio id="bgm" src="../../audio/gacha_bgm.mp3" loop></audio>
    <audio id="sfx-open" src="../../audio/open.mp3"></audio>
    <audio id="sfx-coin" src="../../audio/coin.mp3"></audio>

    <div class="game-container">
        <div class="play-area">
            <div class="info-bar">
                <div class="money-box">
                    <i class="fa-solid fa-coins" style="color:#f1c40f;"></i>
                    <span id="moneyDisplay">0</span>
                </div>
                <br>
                <div class="cps-box" id="cpsDisplay">í«ë“¤ì´ ì´ˆë‹¹ 0ì›ì„ ë²Œì–´ì˜µë‹ˆë‹¤</div>
            </div>

            <div class="egg-btn" id="eggBtn" onclick="clickEgg()">
                <img src="../../images/pet-gacha/egg.png" alt="Egg">
            </div>

            <button class="gacha-btn" onclick="tryGacha()">
                ì•Œ ë½‘ê¸° <span id="costDisplay">(100ì›)</span>
            </button>

            <div class="ad-area" id="ad-game-bottom"></div>
        </div>

        <div class="inventory-area">
            <div class="inv-header">
                <h3>ğŸ’ ë‚´ ê°€ë°© <small style="font-size:0.8rem">(í´ë¦­í•˜ì—¬ íŒë§¤)</small></h3>
            </div>
            <div class="inv-list" id="invList"></div>
            
            <div class="pet-popup" id="petPopup">
                <h3 id="popName" style="margin:0;">í« ì´ë¦„</h3>
                <p id="popGrade" style="color:#888; margin:5px 0;">ë“±ê¸‰</p>
                <div style="font-size:0.9rem; color:#555;">ë³´ìœ  ìˆ˜ëŸ‰: <b id="popCount">0</b>ë§ˆë¦¬</div>
                <div style="font-size:0.9rem; color:#555;">íŒë§¤ ê°€ê²©: <b id="popPrice" style="color:#27ae60">0</b>ì›</div>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="sell-btn" onclick="sellCurrentPet(1)">1ë§ˆë¦¬ íŒ”ê¸°</button>
                    <button class="sell-btn" style="background:#e67e22;" onclick="sellCurrentPet('all')">ëª¨ë‘ íŒ”ê¸°</button>
                </div>
                <button onclick="closePopup()" style="background:none; border:none; color:#999; margin-top:10px; cursor:pointer;">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div class="result-screen" id="resultScreen" onclick="closeResult()">
        <div class="card-reveal" id="resultCard">
            <h2 id="resGrade" style="margin-top:0;">RARE</h2>
            <img id="resImg" src="" style="width:120px; height:120px; object-fit:contain; margin:10px 0;">
            <h1 id="resName" style="margin:0; font-family:'Black Han Sans';">ì´ë¦„</h1>
            <p style="color:#888;">í™”ë©´ì„ ëˆŒëŸ¬ì„œ ë‹«ê¸°</p>
        </div>
    </div>

    <script src="../../js/ads.js"></script>
    <script>
        // [ì„¤ì •] í« ëª©ë¡ (12ì¢…) - íŒŒì¼ëª…ê³¼ ì´ë¦„ ë§¤ì¹­ í™•ì¸í•˜ì„¸ìš”!
        const PET_DATA = [
            // ì¼ë°˜ (Common)
            { id: "mouse", name: "ìƒì¥", grade: "C", price: 100, sell: 50, cps: 1, chance: 30, img: "mouse.png" },
            { id: "dog", name: "ë©ë©ì´", grade: "C", price: 100, sell: 50, cps: 2, chance: 25, img: "dog.png" },
            { id: "cat", name: "ì•¼ì˜¹ì´", grade: "C", price: 100, sell: 50, cps: 2, chance: 20, img: "cat.png" },
            { id: "duck", name: "ì˜¤ë¦¬", grade: "C", price: 100, sell: 50, cps: 3, chance: 15, img: "duck.png" },
            
            // í¬ê·€ (Rare)
            { id: "fox", name: "ì—¬ìš°", grade: "R", price: 300, sell: 150, cps: 10, chance: 5, img: "fox.png" },
            { id: "bear", name: "ì•„ê¸°ê³°", grade: "R", price: 300, sell: 150, cps: 15, chance: 2, img: "bear.png" },
            { id: "pig", name: "ê½ƒë¼ì§€", grade: "R", price: 300, sell: 150, cps: 15, chance: 1.5, img: "pig.png" },
            { id: "wolf", name: "ëŠ‘ëŒ€", grade: "R", price: 300, sell: 150, cps: 20, chance: 1, img: "wolf.png" },

            // ì˜ì›… (Epic)
            { id: "unicorn", name: "ìœ ë‹ˆì½˜", grade: "E", price: 1000, sell: 500, cps: 80, chance: 0.4, img: "unicorn.png" },
            { id: "tiger", name: "í˜¸ë‘ì´", grade: "E", price: 1000, sell: 500, cps: 100, chance: 0.2, img: "tiger.png" },

            // ì „ì„¤ (Legend)
            { id: "dragon", name: "ë“œë˜ê³¤", grade: "L", price: 5000, sell: 2500, cps: 500, chance: 0.05, img: "dragon.png" },

            // ì‹ í™” (Mythic)
            { id: "alien", name: "ìš°ì£¼ì‹ ", grade: "M", price: 50000, sell: 25000, cps: 2000, chance: 0.01, img: "alien.png" }
        ];

        let game = {
            money: 0,
            pets: {} // { "dog": 5, "cat": 2 } í˜•íƒœë¡œ ì €ì¥
        };

        // UI ìš”ì†Œ
        const ui = {
            money: document.getElementById('moneyDisplay'),
            cps: document.getElementById('cpsDisplay'),
            inv: document.getElementById('invList'),
            popup: document.getElementById('petPopup')
        };
        
        let selectedPetId = null; // í˜„ì¬ ì„ íƒëœ í« (íŒë§¤ìš©)

        // ê²Œì„ ì´ˆê¸°í™”
        function init() {
            // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            const saved = localStorage.getItem('petGachaV2');
            if (saved) {
                game = JSON.parse(saved);
            } else {
                // ì´ˆê¸° ë°ì´í„°: ëª¨ë“  í« 0ë§ˆë¦¬
                PET_DATA.forEach(p => game.pets[p.id] = 0);
            }
            
            // BGM ìë™ ì¬ìƒ ì‹œë„
            document.body.addEventListener('click', () => {
                document.getElementById('bgm').volume = 0.2;
                document.getElementById('bgm').play().catch(()=>{});
            }, { once: true });

            updateUI();
            
            // ìë™ ìˆ˜ìµ ë£¨í”„ (1ì´ˆë§ˆë‹¤)
            setInterval(() => {
                let cps = calculateCPS();
                if(cps > 0) {
                    game.money += cps;
                    updateUI();
                    saveGame();
                }
            }, 1000);
        }

        function calculateCPS() {
            let total = 0;
            PET_DATA.forEach(p => {
                if(game.pets[p.id]) total += (p.cps * game.pets[p.id]);
            });
            return total;
        }

        function clickEgg() {
            game.money += 10; // í´ë¦­ ê¸°ë³¸ ìˆ˜ìµ
            updateUI();
            const btn = document.getElementById('eggBtn');
            btn.style.transform = "scale(0.9)";
            setTimeout(() => btn.style.transform = "scale(1)", 100);
        }

        function tryGacha() {
            const cost = 100; // ë½‘ê¸° ë¹„ìš©
            if(game.money < cost) {
                alert("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! í«ì„ íŒ”ê±°ë‚˜ ì•Œì„ í´ë¦­í•˜ì„¸ìš”.");
                return;
            }

            game.money -= cost;
            
            // í™•ë¥  ë¡œì§
            let rand = Math.random() * 100;
            let sum = 0;
            let target = PET_DATA[0];

            for(let p of PET_DATA) {
                sum += p.chance;
                if(rand <= sum) {
                    target = p;
                    break;
                }
            }

            // í« íšë“
            if(!game.pets[target.id]) game.pets[target.id] = 0;
            game.pets[target.id]++;
            
            saveGame();
            updateUI();
            showResult(target);
            document.getElementById('sfx-open').play();
        }

        function showResult(pet) {
            const sc = document.getElementById('resultScreen');
            document.getElementById('resName').innerText = pet.name;
            document.getElementById('resGrade').innerText = getGradeName(pet.grade);
            document.getElementById('resImg').src = `../../images/pet-gacha/${pet.img}`;
            sc.style.display = 'flex';
        }

        function closeResult() {
            document.getElementById('resultScreen').style.display = 'none';
        }

        // ì¸ë²¤í† ë¦¬ í´ë¦­ -> íŒì—… ì—´ê¸°
        function selectPet(id) {
            if(!game.pets[id] || game.pets[id] <= 0) return; // ì—†ëŠ” í«ì€ í´ë¦­ ë¶ˆê°€
            
            selectedPetId = id;
            const pet = PET_DATA.find(p => p.id === id);
            
            document.getElementById('popName').innerText = pet.name;
            document.getElementById('popGrade').innerText = getGradeName(pet.grade);
            document.getElementById('popCount').innerText = game.pets[id];
            document.getElementById('popPrice').innerText = pet.sell.toLocaleString();
            
            ui.popup.classList.add('show');
        }

        function closePopup() {
            ui.popup.classList.remove('show');
        }

        // íŒë§¤ ë¡œì§
        function sellCurrentPet(amount) {
            if(!selectedPetId) return;
            const pet = PET_DATA.find(p => p.id === selectedPetId);
            const currentCount = game.pets[selectedPetId];

            let sellCount = 0;
            if(amount === 'all') sellCount = currentCount;
            else sellCount = 1;

            if(currentCount >= sellCount) {
                game.pets[selectedPetId] -= sellCount;
                game.money += (pet.sell * sellCount);
                
                document.getElementById('sfx-coin').play();
                saveGame();
                updateUI();
                
                // íŒì—… ì •ë³´ ê°±ì‹  (ë‹¤ íŒ”ì•˜ìœ¼ë©´ ë‹«ê¸°)
                if(game.pets[selectedPetId] <= 0) closePopup();
                else selectPet(selectedPetId);
            }
        }

        function updateUI() {
            ui.money.innerText = Math.floor(game.money).toLocaleString();
            ui.cps.innerText = `í«ë“¤ì´ ì´ˆë‹¹ ${calculateCPS().toLocaleString()}ì›ì„ ë²Œì–´ì˜µë‹ˆë‹¤`;

            ui.inv.innerHTML = "";
            PET_DATA.forEach(p => {
                const count = game.pets[p.id] || 0;
                const el = document.createElement('div');
                el.className = `inv-item g-${p.grade} ${count === 0 ? 'locked' : ''}`;
                el.onclick = () => selectPet(p.id);
                el.innerHTML = `
                    <div style="font-size:0.8rem; color:#555; margin-bottom:5px;">${p.name}</div>
                    <img src="../../images/pet-gacha/${p.img}" onerror="this.src='https://via.placeholder.com/60?text=?'">
                    <div style="background:#333; color:white; border-radius:10px; font-size:0.8rem; margin-top:5px;">x${count}</div>
                `;
                ui.inv.appendChild(el);
            });
        }

        function saveGame() {
            localStorage.setItem('petGachaV2', JSON.stringify(game));
        }

        function getGradeName(g) {
            const names = { "C": "ì¼ë°˜", "R": "í¬ê·€", "E": "ì˜ì›…", "L": "ì „ì„¤", "M": "ì‹ í™”" };
            return names[g] || g;
        }

        init();

    </script>
</body>
</html>
